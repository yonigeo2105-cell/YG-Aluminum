<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•× PRO X</title>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #0d47a1; --primary-light: #42a5f5; --bg: #f0f4f8; --card: #ffffff; --text-dark: #1a202c; --whatsapp: #25D366; --border: #cbd5e0; --input-bg: #f7fafc; --danger: #e53e3e; }
        body { font-family: 'Rubik', sans-serif; background-color: var(--bg); margin: 0; padding: 0; color: var(--text-dark); -webkit-tap-highlight-color: transparent; }
        header { background: linear-gradient(135deg, var(--primary) 0%, #1976d2 100%); color: white; padding: 30px 20px 40px; text-align: center; border-bottom-left-radius: 35px; border-bottom-right-radius: 35px; box-shadow: 0 10px 25px rgba(13,71,161,0.25); position: relative; z-index: 10; }
        header h1 { margin: 0; font-size: 26px; font-weight: 800; }
        .container { padding: 0 20px; max-width: 650px; margin: -30px auto 0; padding-bottom: 140px; position: relative; z-index: 20; }
        .card { background: var(--card); border-radius: 18px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); border: 1px solid white; }
        .card-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .card-title { font-size: 18px; font-weight: 700; color: var(--primary); }
        .min-charge-tag { font-size: 12px; background: #ebf8ff; color: #2b6cb0; padding: 2px 6px; border-radius: 4px; display: none; }
        .btn-delete { background: #fff5f5; color: var(--danger); border: 1px solid #fed7d7; padding: 6px 12px; border-radius: 8px; font-size: 13px; font-weight: 600; }
        label { font-weight: 600; display: block; margin-bottom: 6px; font-size: 14px; }
        input, select { width: 100%; padding: 14px; border: 1px solid var(--border); border-radius: 10px; font-size: 16px; background-color: var(--input-bg); margin-bottom: 15px; font-family: 'Rubik', sans-serif; }
        input:focus, select:focus { border-color: var(--primary-light); outline: none; box-shadow: 0 0 0 3px rgba(66, 165, 245, 0.15); background: #fff; }
        .row { display: flex; gap: 12px; } .row > div { flex: 1; }
        .color-tabs { display: flex; background: #e2e8f0; padding: 4px; border-radius: 12px; margin-bottom: 15px; }
        .tab { flex: 1; text-align: center; padding: 10px; font-size: 14px; font-weight: 600; border-radius: 9px; cursor: pointer; color: var(--text-light); transition: all 0.2s; }
        .tab.active { background: white; color: var(--primary); box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        .btn-add-item { width: 100%; background: white; color: var(--primary); border: 2px dashed var(--primary-light); padding: 15px; border-radius: 15px; font-size: 16px; font-weight: 700; margin-bottom: 20px; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .bottom-actions { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 15px 20px 25px; box-shadow: 0 -5px 25px rgba(0,0,0,0.1); z-index: 100; border-radius: 20px 20px 0 0; }
        .btn-calc { width: 100%; background: linear-gradient(90deg, var(--primary) 0%, #1565c0 100%); color: white; padding: 16px; border: none; border-radius: 12px; font-size: 18px; font-weight: 700; box-shadow: 0 4px 15px rgba(13, 71, 161, 0.3); }
        .result-box { background: white; border-radius: 20px; border: 2px solid var(--primary-light); margin-top: 25px; display: none; overflow: hidden; margin-bottom: 20px; }
        .result-header { background: var(--primary-light); color: white; padding: 15px; text-align: center; font-weight: 700; }
        .result-body { padding: 20px; }
        .price-line { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .total-line { font-size: 24px; font-weight: 800; color: var(--primary); border-top: 2px dashed #cbd5e0; padding-top: 15px; margin-top: 15px; display: flex; justify-content: space-between; }
        .modal-overlay { position: fixed; top: 0; right: 0; left: 0; bottom: 0; background: rgba(0,0,0,0.85); display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(5px); }
        .modal-content { background: white; width: 95%; max-width: 450px; border-radius: 20px; padding: 20px; max-height: 90vh; display: flex; flex-direction: column; overflow-y: auto; }
        .preview-text { background: #f7fafc; padding: 15px; border-radius: 10px; border: 1px solid #e2e8f0; white-space: pre-wrap; font-size: 13px; margin-bottom: 15px; line-height: 1.5; }
        .modal-btns { display: flex; gap: 10px; margin-top: 10px; }
        .btn-modal { flex: 1; padding: 12px; border-radius: 10px; border: none; font-weight: 700; font-size: 16px; }
        .btn-cancel { background: #edf2f7; } .btn-send { background: var(--whatsapp); color: white; }
        .btn-download-sketch { background-color: #2d3748; color: white; padding: 10px 15px; border-radius: 8px; font-size: 14px; border: none; cursor: pointer; margin-top: 10px; display: inline-flex; align-items: center; gap: 8px; font-weight: 500; transition: 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn-download-sketch:active { transform: scale(0.98); }
        canvas { display: none; } 
    </style>
</head>
<body>
<header><h1>×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•×</h1><p>××¢×¨×›×ª ×”×¦×¢×•×ª ××—×™×¨ ××§×¦×•×¢×™×ª</p></header>
<div class="container">
    <div class="card"><div class="card-title">ğŸ‘¤ ×œ×§×•×—</div><div class="row"><div style="flex:2"><label>×©×:</label><input type="text" id="clientName" placeholder="×©× ××œ×"></div><div style="flex:1"><label>×”×¦×¢×”:</label><input type="number" id="quoteNumber" style="font-weight:700;text-align:center"></div></div></div>
    
    <div id="itemsContainer"></div>
    
    <button class="btn-add-item" onclick="addItem()">â• ×”×•×¡×£ ×¤×¨×™×˜</button>
    <div class="card" style="background:#ebf8ff; border:1px solid #bee3f8;"><div class="card-title">ğŸ› ï¸ ×ª×•×¡×¤×•×ª</div><label>×”×•×‘×œ×”, ×”×ª×§× ×” ×•×¤×™×¨×•×§ (â‚ª):</label><input type="number" id="installationCost" placeholder="0"></div>
    
    <div class="result-box" id="resultBox"><div class="result-header">×¡×™×›×•×</div><div class="result-body">
        <div class="price-line"><span>×¢×‘×•×“×•×ª ××œ×•××™× ×™×•×:</span><span id="itemsSubtotal">0 â‚ª</span></div>
        <div class="price-line"><span>×”×ª×§× ×”/×¤×™×¨×•×§:</span><span id="installSubtotal">0 â‚ª</span></div>
        <div class="price-line" style="border-top:1px solid #eee; padding-top:10px; font-weight:bold;"><span>×¡×”"×› ×œ×¤× ×™ ××¢"×:</span><span id="totalSub">0 â‚ª</span></div>
        <div class="price-line"><span>××¢"× (18%):</span><span id="totalVat">0 â‚ª</span></div>
        <div class="total-line"><span>×œ×ª×©×œ×•×:</span><span id="totalFinal">0 â‚ª</span></div>
        <button class="btn-add-item" style="margin-top:20px; background:var(--whatsapp); color:white; border:none;" onclick="openPreview()">×©×œ×— ×”×¦×¢×” ×‘×•×•××˜×¡××¤</button>
    </div></div>
</div>
<div class="bottom-actions"><button class="btn-calc" onclick="calculateAll()">×—×©×‘ ×¡×”"×›</button></div>

<div class="modal-overlay" id="previewModal">
    <div class="modal-content">
        <h3 style="text-align:center;margin:0 0 15px 0;color:var(--primary)">× ×•×¡×— ×”×”×•×“×¢×”</h3>
        <div class="preview-text" id="previewText"></div>
        <div class="modal-btns"><button class="btn-modal btn-cancel" onclick="closePreview()">×¢×¨×•×š</button><button class="btn-modal btn-send" onclick="sendWhatsapp()">×©×œ×— ×œ×•×•××˜×¡××¤</button></div>
    </div>
</div>

<script>
const profilesDB = {
    "window_slide": ["×§×œ×™×œ 7000 (×§×œ××¡×™)", "×§×œ×™×œ 9000 (×™×•×§×¨×ª×™)", "×§×œ×™×œ 9200 (×¤× ×•×¨××™)", "×§×œ×™×œ 1700 (×‘×œ×’×™)", "×§×œ×™×œ 7300 (×‘×œ×’×™)", "×§×œ×™×œ 2200 (××•×¤×™×¡)", "×‘××•×”××•×¡ ×”×–×–×”", "××§×¡×˜×œ 22"],
    "window_hinge": ["×§×œ×™×œ 4300 (×‘×œ×’×™)", "×§×œ×™×œ 4400 (×§×œ××¡×™)", "×§×œ×™×œ 4500 (×¡×™×¡×˜×)", "×§×œ×™×œ 5500 (×‘××•×”××•×¡)"],
    "window_kipp": ["×§×œ×™×œ 4300 ×§×™×¤", "×§×œ×™×œ 4400 ×§×™×¤", "×§×œ×™×œ 4500 ×§×™×¤", "×§×œ×™×œ 5500 ×§×™×¤ (×‘××•×”××•×¡)"],
    "window_drykeep": ["×“×¨×™×™-×§×™×¤ 4300 (×‘×œ×’×™)", "×“×¨×™×™-×§×™×¤ 4500 (×§×œ××¡×™)", "×“×¨×™×™-×§×™×¤ 5500 (×‘××•×”××•×¡)", "×“×¨×™×™-×§×™×¤ ××§×¡×˜×œ C10"],
    "window_fixed": ["×§×‘×•×¢ 4300", "×§×‘×•×¢ 4400", "×§×‘×•×¢ 7000", "×§×‘×•×¢ 9000", "×§×‘×•×¢ ×‘××•×”××•×¡"],
    "vitrine": ["×•×™×˜×¨×™× ×” ×§×œ×™×œ 9000", "×•×™×˜×¨×™× ×” ×§×œ×™×œ 9200", "×•×™×˜×¨×™× ×” ×§×œ×™×œ 7300", "×•×™×˜×¨×™× ×” ××™× ×™××œ"],
    "shutter": ["×©×œ×‘ ××•×§×¦×£", "×©×œ×‘ ××©×•×š (×—×–×§)", "×©×œ×‘ ××•×¨", "×©×œ×‘ ××•×¨-×§×œ (××™× ×™)", "×©×œ×‘ ××©×•×š-×¢×œ (××™×’×•×Ÿ)", "××¨×’×– ××•× ×•×‘×œ×•×§"],
    "door": ["×“×œ×ª ×§×œ×™×œ 4300 (×‘×œ×’×™)", "×“×œ×ª ×§×œ×™×œ 2000 (××•×¤×™×¡)", "×“×œ×ª ×›× ×™×¡×” 4900", "×“×œ×ª ××™× ×˜×¨×§×•×", "×“×œ×ª ×¨×‘ ×‘×¨×™×—"],
    "screen": ["×¨×©×ª ×’×œ×™×œ×”", "×¨×©×ª ×”×–×–×”", "×¨×©×ª ×§×‘×•×¢×”", "×¨×©×ª ×©×§×•×¤×”", "×¨×©×ª ×’×¨×× ×™×ª"],
    "pergola": ["×¤×¨×’×•×œ×” ×ª×œ×•×™×”", "×¤×¨×’×•×œ×” ×¢×•××“×ª", "×’×“×¨ ××œ×•××™× ×™×•×", "××¡×ª×•×¨ ×›×‘×™×¡×”"]
};
let itemCount = 0; let finalLink = "";
document.addEventListener('DOMContentLoaded', () => { 
    const saved = localStorage.getItem('quoteCounter'); 
    document.getElementById('quoteNumber').value = saved ? saved : 1; 
    addItem(); 
});

function addItem() {
    itemCount++;
    const container = document.getElementById('itemsContainer');
    const itemDiv = document.createElement('div');
    itemDiv.className = 'card fade-in item-card';
    itemDiv.id = `item-${itemCount}`;
    itemDiv.innerHTML = `
        <div class="card-header-row"><div class="card-title">×¤×¨×™×˜ #${itemCount} <span class="min-charge-tag">××™× ×™××•× 1 ×"×¨</span></div>${itemCount > 1 ? `<button class="btn-delete" onclick="removeItem('${itemDiv.id}')">××—×§</button>` : ''}</div>
        <label>×¡×•×’ ××•×¦×¨:</label><select class="item-product" onchange="updateItemProfiles(this)"><option value="" disabled selected>-- ×‘×—×¨ --</option><option value="window_slide">×—×œ×•×Ÿ ×”×–×–×”</option><option value="window_hinge">×—×œ×•×Ÿ ×¤×ª×™×—×” (×¦×™×¨)</option><option value="window_kipp">×—×œ×•×Ÿ ×§×™×¤ (×¤×ª×™×—×” ×¢×œ×™×•× ×”)</option><option value="window_drykeep">×—×œ×•×Ÿ ×“×¨×™×™-×§×™×¤</option><option value="window_fixed">×—×œ×•×Ÿ ×§×‘×•×¢ (FIX)</option><option value="vitrine">×•×™×˜×¨×™× ×”</option><option value="shutter">×ª×¨×™×¡ ×’×œ×™×œ×”</option><option value="door">×“×œ×ª×•×ª</option><option value="screen">×¨×©×ª×•×ª</option><option value="pergola">×¤×¨×’×•×œ×•×ª/×’×“×¨×•×ª</option></select>
        
        <div class="wings-section" style="display:none; background:#fffbe6; padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid #ffe58f;">
            <div class="row">
                <div style="flex:1"><label style="color:#d48806">×›× ×¤×™×™×:</label><select class="item-wings" style="border-color:#d48806"><option value="1">1</option><option value="2" selected>2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option></select></div>
                <div style="flex:1"><label style="color:#d48806">×¡×’×™×¨×”:</label><select class="item-mifgash" style="border-color:#d48806"><option value="×œ×œ× ××¤×’×©">×œ×œ× ××¤×’×©</option><option value="××¤×’×© (××¨×›×–)">××¤×’×© (××¨×›×–)</option></select></div>
            </div>
        </div>

        <div class="direction-section" style="display:none; background:#e3f2fd; padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid #90caf9;">
            <label style="color:#1565c0; font-weight:bold;">×›×™×•×•×Ÿ ×¤×ª×™×—×” (××‘×˜ ××‘×¤× ×™×):</label>
            <select class="item-direction" style="border-color:#1565c0;">
                <option value="×™××™×Ÿ">×™××™×Ÿ (×¦×™×¨ ×™××™×Ÿ, ×™×“×™×ª ×©×××œ)</option>
                <option value="×©×××œ">×©×××œ (×¦×™×¨ ×©×××œ, ×™×“×™×ª ×™××™×Ÿ)</option>
            </select>
        </div>

        <div class="pergola-section" style="display:none; background:#f0fff4; padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid #c6f6d5;">
            <label style="color:#276749; font-weight:bold;">×›×™×•×•×Ÿ ×¨×¤×¤×•×ª (×¤×¡×™×):</label>
            <select class="item-pergola-dir" style="border-color:#276749;">
                <option value="parallel">××§×‘×™×œ ×œ×—×–×™×ª (×œ×¨×•×—×‘)</option>
                <option value="perpendicular">× ×™×¦×‘ ×œ×—×–×™×ª (×œ×¢×•××§)</option>
            </select>
            <div class="row" style="margin-top:10px;">
                <div style="flex:1">
                    <label style="color:#276749;">×¢×•××§ (×™×¦×™××” ×‘×¡"×):</label>
                    <input type="number" class="item-depth" placeholder="×œ×“×•×’××” 300" style="border-color:#276749;">
                </div>
            </div>
        </div>

        <label>×“×’×:</label><select class="item-profile" onchange="updateDimensionLabels(this)"><option value="">×‘×—×¨ ×§×•×“× ××•×¦×¨...</option></select>
        
        <label style="margin-top:10px">×’×•×•×Ÿ:</label><div class="color-tabs"><div class="tab active" onclick="switchItemColor(this, 'ral')">RAL</div><div class="tab" onclick="switchItemColor(this, 'klil')">×§×œ×™×œ</div></div>
        <div class="ral-section"><select class="item-color">
            <optgroup label="×œ×‘× ×™× ×•×©×× ×ª"><option value="×œ×‘×Ÿ (9010)">×œ×‘×Ÿ (9010)</option><option value="×œ×‘×Ÿ ××‘×¨×™×§ (9016)">×œ×‘×Ÿ ××‘×¨×™×§ (9016)</option><option value="×©×× ×ª (1013)">×©×× ×ª (1013)</option><option value="×‘×–' (1015)">×‘×–' ×‘×”×™×¨ (1015)</option></optgroup>
            <optgroup label="××¤×•×¨×™×"><option value="××¤×•×¨ 7035 (×‘×”×™×¨)">××¤×•×¨ 7035</option><option value="××¤×•×¨ 7000">××¤×•×¨ 7000</option><option value="××¤×•×¨ 7012">××¤×•×¨ 7012</option><option value="××¤×•×¨ 7015">××¤×•×¨ 7015</option><option value="××¤×•×¨ 7016 (×× ×˜×¨×¦×™×˜)">××¤×•×¨ ×× ×˜×¨×¦×™×˜ (7016)</option><option value="××¤×•×¨ 7021 (×›×”×”)">××¤×•×¨ 7021</option><option value="××¤×•×¨ 7023 (×‘×˜×•×Ÿ)">××¤×•×¨ ×‘×˜×•×Ÿ (7023)</option><option value="××¤×•×¨ 7024 (×’×¨×¤×™×˜)">××¤×•×¨ ×’×¨×¤×™×˜ (7024)</option><option value="××¤×•×¨ 7040">××¤×•×¨ 7040</option><option value="××¤×•×¨ 9006 (×›×¡×•×£)">×›×¡×•×£ (9006)</option><option value="××¤×•×¨ 9007">××œ×•××™× ×™×•× ×›×”×” (9007)</option></optgroup>
            <optgroup label="×©×—×•×¨×™× ×•×—×•××™×"><option value="×©×—×•×¨ (9005)">×©×—×•×¨ (9005)</option><option value="×—×•× 8014">×—×•× 8014</option><option value="×—×•× 8017 (×©×•×§×•×œ×“)">×—×•× ×©×•×§×•×œ×“ (8017)</option><option value="×—×•× 8019 (×›×”×”)">×—×•× ×›×”×” (8019)</option><option value="×—×•× 8011 (××’×•×–)">×—×•× ××’×•×– (8011)</option></optgroup>
            <optgroup label="×¦×‘×¢×•× ×™"><option value="×›×—×•×œ (5010)">×›×—×•×œ (5010)</option><option value="×™×¨×•×§ (6005)">×™×¨×•×§ ×‘×§×‘×•×§ (6005)</option><option value="××“×•× (3000)">××“×•× (3000)</option><option value="××œ×•××™× ×™×•× ×˜×‘×¢×™">××œ×•××™× ×™×•× ×˜×‘×¢×™</option></optgroup>
        </select></div>
        <div class="klil-section" style="display:none"><select class="item-color-klil">
            <optgroup label="×§×œ×™×œ ×§×œ××¡×™×§/×‘×™×™×¡×™×§"><option value="×œ×‘×Ÿ ×§×œ××¡×™×§">×œ×‘×Ÿ ×§×œ××¡×™×§</option><option value="×©×× ×ª ×§×œ××¡×™×§">×©×× ×ª ×§×œ××¡×™×§</option></optgroup>
            <optgroup label="×§×œ×™×œ ××•×¤×™×¡"><option value="×œ×‘×Ÿ ××•×¤×™×¡">×œ×‘×Ÿ ××•×¤×™×¡</option><option value="×©×× ×ª ××•×¤×™×¡">×©×× ×ª ××•×¤×™×¡</option><option value="××¤×•×¨ ××•×¤×™×¡">××¤×•×¨ ××•×¤×™×¡</option><option value="×©×—×•×¨ ××•×¤×™×¡">×©×—×•×¨ ××•×¤×™×¡</option></optgroup>
            <optgroup label="×§×œ×™×œ IRON (××’×•×¨×¢×Ÿ)"><option value="IRON 100 ×œ×‘×Ÿ">IRON 100 ×œ×‘×Ÿ</option><option value="IRON 101 ×©×× ×ª">IRON 101 ×©×× ×ª</option><option value="IRON 400 ××¤×•×¨ ×›×”×”">IRON 400 ××¤×•×¨ ×›×”×”</option><option value="IRON 415 ××¤×•×¨ ××‘×Ÿ">IRON 415 ××¤×•×¨ ××‘×Ÿ</option><option value="IRON 420 ×©×—×•×¨ ×’×¨×¤×™×˜">IRON 420 ×©×—×•×¨ ×’×¨×¤×™×˜</option><option value="IRON 700 ××¤×•×¨ ×‘×”×™×¨">IRON 700 ××¤×•×¨ ×‘×”×™×¨</option><option value="IRON 819 ×—×•×">IRON 819 ×—×•×</option></optgroup>
            <optgroup label="×§×œ×™×œ FINE IRON (×—×œ×§)"><option value="FINE IRON 9010">FINE IRON 9010 (×œ×‘×Ÿ)</option><option value="FINE IRON 9005">FINE IRON 9005 (×©×—×•×¨)</option><option value="FINE IRON 7016">FINE IRON 7016 (××¤×•×¨)</option><option value="FINE IRON 1013">FINE IRON 1013 (×©×× ×ª)</option></optgroup>
            <optgroup label="×§×œ×™×œ ×× ×•×“×™×™×–"><option value="×× ×•×“×™×™×– ×˜×‘×¢×™ (××˜)">×× ×•×“×™×™×– ×˜×‘×¢×™ (××˜)</option><option value="×× ×•×“×™×™×– ×‘×¨×•× ×–×”">×× ×•×“×™×™×– ×‘×¨×•× ×–×”</option><option value="×× ×•×“×™×™×– ×©××¤× ×™×”">×× ×•×“×™×™×– ×©××¤× ×™×”</option><option value="×× ×•×“×™×™×– ×©×—×•×¨">×× ×•×“×™×™×– ×©×—×•×¨</option></optgroup>
        </select></div>
        
        <label style="margin-top:10px">×–×›×•×›×™×ª:</label><div class="row"><div style="flex:2"><select class="item-glass-type"><option value="×œ×œ× ×–×›×•×›×™×ª">×œ×œ× ×–×›×•×›×™×ª</option><optgroup label="×˜×¨×™×¤×œ×§×¡"><option value="×˜×¨×™×¤×œ×§×¡ 3+3">×˜×¨×™×¤×œ×§×¡ 3+3</option><option value="×˜×¨×™×¤×œ×§×¡ 3+4">×˜×¨×™×¤×œ×§×¡ 3+4</option><option value="×˜×¨×™×¤×œ×§×¡ 4+4">×˜×¨×™×¤×œ×§×¡ 4+4</option><option value="×˜×¨×™×¤×œ×§×¡ 4+5">×˜×¨×™×¤×œ×§×¡ 4+5</option><option value="×˜×¨×™×¤×œ×§×¡ 5+5">×˜×¨×™×¤×œ×§×¡ 5+5</option><option value="×˜×¨×™×¤×œ×§×¡ 5+6">×˜×¨×™×¤×œ×§×¡ 5+6</option><option value="×˜×¨×™×¤×œ×§×¡ 6+6">×˜×¨×™×¤×œ×§×¡ 6+6</option></optgroup><optgroup label="×‘×™×“×•×“×™×ª"><option value="×‘×™×“×•×“×™×ª 4-6-4">×‘×™×“×•×“×™×ª 4-6-4</option><option value="×‘×™×“×•×“×™×ª 4-9-4">×‘×™×“×•×“×™×ª 4-9-4</option><option value="×‘×™×“×•×“×™×ª 6-12-6">×‘×™×“×•×“×™×ª 6-12-6</option><option value="×‘×™×“×•×“×™×ª ×¦×œ×•×Ÿ">×‘×™×“×•×“×™×ª ×¦×œ×•×Ÿ</option></optgroup><optgroup label="××—×•×¡××ª"><option value="××—×•×¡××ª 6">××—×•×¡××ª 6 ×''×</option><option value="××—×•×¡××ª 8">××—×•×¡××ª 8 ×''×</option><option value="××—×•×¡××ª 10">××—×•×¡××ª 10 ×''×</option></optgroup></select></div><div style="flex:1"><select class="item-glass-finish"><option value="×©×§×•×£">×©×§×•×£</option><option value="×—×œ×‘×™">×—×œ×‘×™</option><option value="×× ×˜×™-×¡××Ÿ">×× ×˜×™-×¡××Ÿ</option><option value="×¦'×™× ×¦'×™×œ×”">×¦'×™× ×¦'×™×œ×”</option><option value="×¡×‘×ª×">×¡×‘×ª×</option><option value="×’×¨× ×™×˜">×’×¨× ×™×˜</option></select></div></div>
        
        <div class="row" style="margin-top:15px">
            <div><label class="label-width">×¨×•×—×‘ (×¡"×):</label><input type="number" class="item-width" placeholder="150"></div>
            <div><label class="label-height">×’×•×‘×” (×¡"×):</label><input type="number" class="item-height" placeholder="200"></div>
        </div>
        
        <label style="color:var(--primary)">××—×™×¨ ×œ×"×¨ (×œ×¤× ×™ ××¢"×):</label><input type="number" class="item-price" placeholder="â‚ª">
        
        <button class="btn-download-sketch" onclick="generateAndDownloadSketch(this)">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
            ×”×•×¨×“ ×©×¨×˜×•×˜ ××“×¨×™×›×œ×™
        </button>
    `;
    container.appendChild(itemDiv);
}
function removeItem(id) { document.getElementById(id).remove(); }

function updateItemProfiles(el) {
    const card = el.closest('.card');
    const prof = card.querySelector('.item-profile');
    const wings = card.querySelector('.wings-section');
    const direction = card.querySelector('.direction-section');
    const pergolaSec = card.querySelector('.pergola-section');
    const labelW = card.querySelector('.label-width');
    const labelH = card.querySelector('.label-height');
    const val = el.value;
    
    // ××™×¤×•×¡ ×ª×¦×•×’×”
    wings.style.display = 'none';
    direction.style.display = 'none';
    pergolaSec.style.display = 'none';
    labelW.innerText = "×¨×•×—×‘ (×¡\"×):";
    labelH.innerText = "×’×•×‘×” (×¡\"×):";

    if (val === 'window_slide' || val === 'vitrine') {
        wings.style.display = 'block';
    } else if (val === 'window_hinge' || val === 'door' || val === 'window_drykeep') {
        direction.style.display = 'block';
    } else if (val === 'pergola') {
        pergolaSec.style.display = 'block';
        labelW.innerText = "×¨×•×—×‘ ×—×–×™×ª (×¡\"×):"; // ×¢×“×›×•×Ÿ ×˜×§×¡×˜
        labelH.innerText = "×’×•×‘×” (×œ×¢××•×“×™×/××™×§×•×):"; // ×¢×“×›×•×Ÿ ×˜×§×¡×˜
    }

    prof.innerHTML = "";
    if (val && profilesDB[val]) { profilesDB[val].forEach(p => { const o = document.createElement('option'); o.value = p; o.innerText = p; prof.appendChild(o); }); }
    else { prof.innerHTML = '<option>××™×Ÿ ×¤×¨×•×¤×™×œ×™×</option>'; }
}

function updateDimensionLabels(el) {
    // ×¤×•× ×§×¦×™×” ×œ×¢×“×›×•×Ÿ ×ª×•×•×™×•×ª ×œ×¤×™ ×‘×—×™×¨×ª ×¤×¨×•×¤×™×œ (×œ××©×œ ×¤×¨×’×•×œ×” ×¢×•××“×ª)
    const card = el.closest('.card');
    const type = card.querySelector('.item-product').value;
    const profile = el.value;
    const labelH = card.querySelector('.label-height');
    
    if (type === 'pergola') {
        if (profile.includes('×¢×•××“×ª')) {
            labelH.innerText = "×’×•×‘×” ×¢××•×“×™× (×¡\"×):";
        } else {
            labelH.innerText = "×’×•×‘×” ×”×ª×§× ×” (×¡\"×):";
        }
    }
}

function switchItemColor(t, type) {
    const card = t.closest('.card');
    card.querySelectorAll('.tab').forEach(x => x.classList.remove('active'));
    t.classList.add('active');
    card.querySelector('.ral-section').style.display = type === 'ral' ? 'block' : 'none';
    card.querySelector('.klil-section').style.display = type === 'klil' ? 'block' : 'none';
    card.setAttribute('data-color-type', type);
}

function calculateAll() {
    const cards = document.querySelectorAll('.item-card');
    let sub = 0; let valid = true;
    if (cards.length === 0) { alert("××™×Ÿ ×¤×¨×™×˜×™×"); return; }
    cards.forEach(c => {
        const type = c.querySelector('.item-product').value;
        const w = parseFloat(c.querySelector('.item-width').value);
        let h = parseFloat(c.querySelector('.item-height').value);
        const p = parseFloat(c.querySelector('.item-price').value);
        
        // ×œ×¤×¨×’×•×œ×•×ª, ×”×©×˜×— ×”×•× ×¨×•×—×‘ X ×¢×•××§
        if (type === 'pergola') {
            const depth = parseFloat(c.querySelector('.item-depth').value);
            if (!depth) { c.style.border = "2px solid red"; valid = false; return; }
            h = depth; // ×‘×—×™×©×•×‘ ×¤×¨×’×•×œ×”, h ××™×™×¦×’ ××ª ×”××™××“ ×”×©× ×™ ×œ×©×˜×—
        }

        if (!w || !h || !p) { c.style.border = "2px solid red"; valid = false; }
        else {
            c.style.border = "1px solid white";
            let area = (w * h) / 10000;
            if (area < 1.0) { area = 1.0; c.querySelector('.min-charge-tag').style.display = 'inline-block'; }
            else { c.querySelector('.min-charge-tag').style.display = 'none'; }
            sub += area * p;
        }
    });
    if (!valid) { alert("×—×¡×¨×™× × ×ª×•× ×™×"); return; }
    const install = parseFloat(document.getElementById('installationCost').value) || 0;
    const totalSub = sub + install;
    const vat = totalSub * 0.18;
    const total = totalSub + vat;
    document.getElementById('itemsSubtotal').innerText = sub.toLocaleString() + " â‚ª";
    document.getElementById('installSubtotal').innerText = install.toLocaleString() + " â‚ª";
    document.getElementById('totalSub').innerText = totalSub.toLocaleString() + " â‚ª";
    document.getElementById('totalVat').innerText = vat.toLocaleString() + " â‚ª";
    document.getElementById('totalFinal').innerText = total.toLocaleString() + " â‚ª";
    document.getElementById('resultBox').style.display = 'block';
    setTimeout(() => document.querySelector('.bottom-actions').scrollIntoView(), 100);
}

function openPreview() {
    if (document.getElementById('resultBox').style.display === 'none') { alert("× × ×œ×—×©×‘ ×§×•×“×"); return; }
    const qNum = document.getElementById('quoteNumber').value;
    const client = document.getElementById('clientName').value || "×œ×§×•×—";
    const install = document.getElementById('installSubtotal').innerText;
    let txt = ""; let i = 1;
    document.querySelectorAll('.item-card').forEach(c => {
        const typeVal = c.querySelector('.item-product').value;
        const type = c.querySelector('.item-product').options[c.querySelector('.item-product').selectedIndex].text;
        const prof = c.querySelector('.item-profile').value;
        
        let extra = "";
        const wingsSec = c.querySelector('.wings-section');
        const dirSec = c.querySelector('.direction-section');
        
        if (typeVal === 'pergola') {
            const depth = c.querySelector('.item-depth').value;
            const pDir = c.querySelector('.item-pergola-dir').options[c.querySelector('.item-pergola-dir').selectedIndex].text;
            extra = `\n   ×¢×•××§ (×™×¦×™××”): ${depth} ×¡"×\n   ×›×™×•×•×Ÿ ×¨×¤×¤×•×ª: ${pDir}`;
        } else if (wingsSec.style.display !== 'none') {
            extra = `\n   ×›× ×¤×™×™×: ${c.querySelector('.item-wings').value} (${c.querySelector('.item-mifgash').value})`;
        } else if (dirSec.style.display !== 'none') {
            extra = `\n   ×¤×ª×™×—×”: ${c.querySelector('.item-direction').value}`;
        }

        const cType = c.getAttribute('data-color-type') || 'ral';
        const col = cType === 'ral' ? c.querySelector('.item-color').value : c.querySelector('.item-color-klil').value;
        const gType = c.querySelector('.item-glass-type').value;
        const gFin = c.querySelector('.item-glass-finish').value;
        const glass = gType !== '×œ×œ× ×–×›×•×›×™×ª' ? `${gType} (${gFin})` : gType;
        
        const w = parseFloat(c.querySelector('.item-width').value);
        const h = parseFloat(c.querySelector('.item-height').value);
        const pr = parseFloat(c.querySelector('.item-price').value);
        
        let calcDim = h;
        let dimText = `${w}x${h} ×¡"×`;
        if (typeVal === 'pergola') {
            const depth = parseFloat(c.querySelector('.item-depth').value);
            calcDim = depth;
            dimText = `${w} (×—×–×™×ª) x ${depth} (×¢×•××§) ×¡"×`;
        }

        let ar = (w * calcDim) / 10000;
        let note = "";
        if (ar < 1.0) { ar = 1.0; note = "(××™× ×™××•× 1 ×\"×¨)"; }
        const tot = ar * pr;
        txt += `ğŸ”¸ *×¤×¨×™×˜ ${i}: ${type}*${extra}\n   ××¤×¨×˜: ${prof}\n   ×¦×‘×¢: ${col}\n   ×–×›×•×›×™×ª: ${glass}\n   ××™×“×•×ª: ${dimText} ${note}\n   ××—×™×¨: ${tot.toLocaleString()} â‚ª\n\n`;
        i++;
    });
    const finalSub = document.getElementById('totalSub').innerText;
    const finalTot = document.getElementById('totalFinal').innerText;
    const msg = `*×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•× - ×”×¦×¢×ª ××—×™×¨ ××¡' ${qNum}*\n\n×œ×›×‘×•×“: ${client}\n\n${txt}------------------\nğŸ›  *×”×ª×§× ×”:* ${install}\n\nğŸ’µ *×¡×™×›×•×:* \n×œ×¤× ×™ ××¢"×: ${finalSub}\n×¡×”"×› ×›×•×œ×œ ××¢"×: *${finalTot}*\n\n×ª×•×“×”,\n*×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•×*`;
    document.getElementById('previewText').innerText = msg;
    finalLink = `https://wa.me/?text=${encodeURIComponent(msg)}`;
    document.getElementById('previewModal').style.display = 'flex';
}
function closePreview() { document.getElementById('previewModal').style.display = 'none'; }
function sendWhatsapp() { 
    window.open(finalLink, '_blank'); 
    let n = parseInt(document.getElementById('quoteNumber').value);
    if(n) { localStorage.setItem('quoteCounter', n + 1); document.getElementById('quoteNumber').value = n + 1; }
    closePreview(); 
}

// --- ×× ×•×¢ ×©×¨×˜×•×˜ ××“×¨×™×›×œ×™ ×—×›× (Pro v4 - ×›×•×œ×œ ×¤×¨×’×•×œ×•×ª) ---
function generateAndDownloadSketch(btn) {
    const card = btn.closest('.item-card');
    const wVal = parseFloat(card.querySelector('.item-width').value) || 100;
    const hVal = parseFloat(card.querySelector('.item-height').value) || 100;
    const typeSelect = card.querySelector('.item-product');
    const type = typeSelect.value;
    const typeText = typeSelect.options[typeSelect.selectedIndex].text;
    const profile = card.querySelector('.item-profile').value;
    const client = document.getElementById('clientName').value || "";
    
    // × ×ª×•× ×™× × ×•×¡×¤×™×
    let wings = 1; let mifgash = ""; let direction = "";
    let depthVal = 0; let pergolaDir = "";
    
    const wingsSec = card.querySelector('.wings-section');
    const dirSec = card.querySelector('.direction-section');
    const pergSec = card.querySelector('.pergola-section');
    
    if (type === 'pergola') {
        depthVal = parseFloat(card.querySelector('.item-depth').value) || 100;
        pergolaDir = card.querySelector('.item-pergola-dir').value;
    } else if (wingsSec.style.display !== 'none') {
        wings = parseInt(card.querySelector('.item-wings').value);
        mifgash = card.querySelector('.item-mifgash').value;
    } else if (dirSec.style.display !== 'none') {
        direction = card.querySelector('.item-direction').value;
    }

    const cType = card.getAttribute('data-color-type') || 'ral';
    const colorVal = cType === 'ral' ? card.querySelector('.item-color').value : card.querySelector('.item-color-klil').value;
    const glassType = card.querySelector('.item-glass-type').value;
    const glassFinish = card.querySelector('.item-glass-finish').value;
    const glassInfo = glassType !== '×œ×œ× ×–×›×•×›×™×ª' ? `${glassType} ${glassFinish}` : '×œ×œ× ×–×›×•×›×™×ª';

    const canvas = document.createElement('canvas');
    canvas.width = 1200; canvas.height = 900;
    const ctx = canvas.getContext('2d');

    ctx.fillStyle = "white";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    ctx.fillStyle = "#0d47a1";
    ctx.font = "bold 40px Arial";
    ctx.textAlign = "center";
    ctx.fillText("×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•×", canvas.width/2, 60);
    ctx.fillStyle = "#333";
    ctx.font = "24px Arial";
    ctx.fillText(client ? `×œ×§×•×—: ${client}` : "×¡×§×™×¦×” ×œ××™×©×•×¨", canvas.width/2, 100);
    
    ctx.font = "20px Arial";
    ctx.fillStyle = "#555";
    let detailText = `××•×¦×¨: ${typeText} | ×¤×¨×•×¤×™×œ: ${profile} | ×¦×‘×¢: ${colorVal}`;
    ctx.fillText(detailText, canvas.width/2, 135);
    
    if (type === 'pergola') {
        ctx.fillText(`×—×–×™×ª: ${wVal} | ×¢×•××§: ${depthVal} | ×’×•×‘×”: ${hVal}`, canvas.width/2, 160);
    } else {
        ctx.fillText(`×–×›×•×›×™×ª: ${glassInfo}`, canvas.width/2, 160);
        if(direction) ctx.fillText(`×¤×ª×™×—×” (××‘×˜ ×¤× ×™×): ${direction}`, canvas.width/2, 185);
    }

    // ×—×™×©×•×‘ ××™×“×•×ª ×œ×¦×™×•×¨
    const maxDrawW = 800; const maxDrawH = 500;
    // ×× ×¤×¨×’×•×œ×”: ××¦×™×™×¨×™× ××‘×˜ ×¢×œ (×¨×•×—×‘ X ×¢×•××§)
    let dim1 = wVal; 
    let dim2 = (type === 'pergola') ? depthVal : hVal;
    
    const ratio = dim1 / dim2;
    let drawW, drawH;
    
    if (ratio > 1) { drawW = maxDrawW; drawH = maxDrawW / ratio; if (drawH > maxDrawH) { drawH = maxDrawH; drawW = maxDrawH * ratio; } } 
    else { drawH = maxDrawH; drawW = maxDrawH * ratio; if (drawW > maxDrawW) { drawW = maxDrawW; drawH = maxDrawW / ratio; } }

    const startX = (canvas.width - drawW) / 2;
    const startY = 250;
    const frameThick = 15;
    
    ctx.strokeStyle = "#333";
    ctx.lineWidth = 3;

    // --- ×¦×™×•×¨ ---
    if (type === 'pergola') {
        // ××¡×’×¨×ª ×”×™×§×¤×™×ª (×§×•×¨×•×ª)
        ctx.fillStyle = "#f0f0f0";
        ctx.fillRect(startX, startY, drawW, drawH);
        ctx.strokeRect(startX, startY, drawW, drawH);
        
        ctx.strokeStyle = "#555";
        ctx.lineWidth = 2;
        
        // ×¨×¤×¤×•×ª
        const step = 20; // ××¨×•×•×— ×‘×™×Ÿ ×¨×¤×¤×•×ª ×‘×¦×™×•×¨
        if (pergolaDir === 'parallel') {
            // ×œ×¨×•×—×‘ (××•×¤×§×™)
            for (let i = 0; i <= drawH; i += step) {
                ctx.beginPath(); ctx.moveTo(startX, startY + i); ctx.lineTo(startX + drawW, startY + i); ctx.stroke();
            }
        } else {
            // ×œ×¢×•××§ (×× ×›×™)
            for (let i = 0; i <= drawW; i += step) {
                ctx.beginPath(); ctx.moveTo(startX + i, startY); ctx.lineTo(startX + i, startY + drawH); ctx.stroke();
            }
        }
        
        // ×¢××•×“×™× (×× ×¢×•××“×ª) - ×¡×™××•×Ÿ ×¤×™× ×•×ª
        if (profile.includes('×¢×•××“×ª')) {
            ctx.fillStyle = "#333";
            const postSize = 20;
            ctx.fillRect(startX - postSize, startY + drawH, postSize, postSize); // ×¢××•×“ ×§×“××™ ×©×××œ
            ctx.fillRect(startX + drawW, startY + drawH, postSize, postSize); // ×¢××•×“ ×§×“××™ ×™××™×Ÿ
            // ×”×¢×¨×”: ×–×” ××‘×˜ ×¢×œ, ××– ×”×¢××•×“×™× ×”× ×¨×™×‘×•×¢×™× ×‘×¤×™× ×•×ª
        }
        
        // ×›×•×ª×¨×ª ××‘×˜
        ctx.fillStyle = "#0000aa"; ctx.font = "bold 24px Arial";
        ctx.fillText("××‘×˜ ×¢×œ (×ª×•×›× ×™×ª ×’×’)", canvas.width/2, startY - 20);

    } else {
        // --- ×—×œ×•× ×•×ª/×“×œ×ª×•×ª ---
        if (!type.includes('screen') && type !== 'shutter') {
            ctx.strokeRect(startX, startY, drawW, drawH); 
            ctx.strokeRect(startX + frameThick, startY + frameThick, drawW - frameThick*2, drawH - frameThick*2);
        }
        
        // ×–×›×•×›×™×ª
        function drawGlass(x, y, w, h) {
            ctx.save(); ctx.beginPath(); ctx.rect(x, y, w, h); ctx.clip();
            ctx.strokeStyle = "#e0e0e0"; ctx.lineWidth = 1;
            for(let i=0; i<w+h; i+=40) { ctx.moveTo(x + i, y); ctx.lineTo(x, y + i); }
            ctx.stroke(); ctx.restore();
        }
        if (type !== 'shutter' && !type.includes('screen')) {
            drawGlass(startX + frameThick, startY + frameThick, drawW - frameThick*2, drawH - frameThick*2);
        }

        ctx.strokeStyle = "#333"; ctx.lineWidth = 3;

        if (type === 'window_slide' || type === 'vitrine') {
            const wingW = drawW / wings;
            for (let i = 0; i < wings; i++) {
                const wx = startX + i * wingW;
                const offset = (i % 2 === 0) ? 0 : 5; 
                const sashX = wx + offset; const sashW = wingW - offset;
                ctx.strokeRect(sashX + 2, startY + frameThick + 2, sashW - 4, drawH - frameThick*2 - 4);
            }
            ctx.font = "50px Arial"; ctx.fillStyle = "#0d47a1"; const midY = startY + drawH/2;
            if (mifgash.includes('××¤×’×©') && wings >= 2) { ctx.fillText("â†’", startX + drawW/2 - 50, midY); ctx.fillText("â†", startX + drawW/2 + 50, midY); } 
            else { ctx.fillText("â† â†’", startX + drawW/2, midY); }
        }
        else if (type === 'window_hinge' || type === 'door') {
            ctx.setLineDash([20, 15]); ctx.beginPath();
            if (direction === '×™××™×Ÿ') {
                ctx.moveTo(startX + drawW, startY); ctx.lineTo(startX, startY + drawH/2); ctx.lineTo(startX + drawW, startY + drawH);
                ctx.fillStyle = "#222"; ctx.fillRect(startX + frameThick + 5, startY + drawH/2 - 25, 12, 50);
            } else {
                ctx.moveTo(startX, startY); ctx.lineTo(startX + drawW, startY + drawH/2); ctx.lineTo(startX, startY + drawH);
                ctx.fillStyle = "#222"; ctx.fillRect(startX + drawW - frameThick - 17, startY + drawH/2 - 25, 12, 50);
            }
            ctx.stroke(); ctx.setLineDash([]);
        }
        else if (type === 'window_kipp') {
            ctx.setLineDash([20, 15]); ctx.beginPath();
            ctx.moveTo(startX, startY + drawH); ctx.lineTo(startX + drawW/2, startY); ctx.lineTo(startX + drawW, startY + drawH); 
            ctx.stroke(); ctx.setLineDash([]);
            ctx.fillStyle = "#222"; ctx.fillRect(startX + drawW/2 - 25, startY + frameThick + 5, 50, 12);
        }
        else if (type === 'window_drykeep') {
            ctx.setLineDash([20, 15]); ctx.beginPath();
            ctx.moveTo(startX, startY + drawH); ctx.lineTo(startX + drawW/2, startY); ctx.lineTo(startX + drawW, startY + drawH); ctx.stroke();
            ctx.beginPath();
            if (direction === '×™××™×Ÿ') { ctx.moveTo(startX + drawW, startY); ctx.lineTo(startX, startY + drawH/2); ctx.lineTo(startX + drawW, startY + drawH); ctx.fillStyle = "#222"; ctx.fillRect(startX + frameThick + 5, startY + drawH/2 - 25, 12, 50); } 
            else { ctx.moveTo(startX, startY); ctx.lineTo(startX + drawW, startY + drawH/2); ctx.lineTo(startX, startY + drawH); ctx.fillStyle = "#222"; ctx.fillRect(startX + drawW - frameThick - 17, startY + drawH/2 - 25, 12, 50); }
            ctx.stroke(); ctx.setLineDash([]);
        }
        else if (type === 'shutter') {
            const boxH = drawH * 0.2; 
            ctx.fillStyle = "#ddd"; ctx.fillRect(startX, startY, drawW, boxH); ctx.strokeRect(startX, startY, drawW, boxH);
            ctx.fillStyle = "white"; ctx.fillRect(startX, startY + boxH, 20, drawH - boxH); ctx.strokeRect(startX, startY + boxH, 20, drawH - boxH);
            ctx.fillRect(startX + drawW - 20, startY + boxH, 20, drawH - boxH); ctx.strokeRect(startX + drawW - 20, startY + boxH, 20, drawH - boxH);
            ctx.strokeStyle = "#888"; for (let i = boxH; i < drawH; i+=30) { ctx.beginPath(); ctx.moveTo(startX + 20, startY + i); ctx.lineTo(startX + drawW - 20, startY + i); ctx.stroke(); }
        }
        else if (type.includes('screen')) {
            ctx.strokeRect(startX, startY, drawW, drawH);
            ctx.save(); ctx.beginPath(); ctx.rect(startX, startY, drawW, drawH); ctx.clip();
            ctx.strokeStyle = "#ccc"; ctx.lineWidth = 1;
            for(let i=0; i<drawW+drawH; i+=15) { ctx.moveTo(startX + i, startY); ctx.lineTo(startX, startY + i); ctx.moveTo(startX - i + drawW, startY); ctx.lineTo(startX + drawW, startY + i); }
            ctx.stroke(); ctx.restore();
        }
    }

    // --- ××™×“×•×ª ×—×™×¦×•× ×™×•×ª ---
    const dimDist = 60;
    ctx.strokeStyle = "#0000aa"; ctx.fillStyle = "#0000aa"; ctx.font = "bold 40px Arial"; ctx.lineWidth = 2;

    // ××™×“×” ××•×¤×§×™×ª (×¨×•×—×‘)
    const labelBottom = (type === 'pergola') ? "×¨×•×—×‘ ×—×–×™×ª" : "";
    ctx.beginPath(); ctx.moveTo(startX, startY + drawH + dimDist); ctx.lineTo(startX + drawW, startY + drawH + dimDist); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(startX, startY + drawH + dimDist - 15); ctx.lineTo(startX, startY + drawH + dimDist + 15); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(startX + drawW, startY + drawH + dimDist - 15); ctx.lineTo(startX + drawW, startY + drawH + dimDist + 15); ctx.stroke();
    ctx.fillText(`${dim1} ${labelBottom}`, startX + drawW/2 - 30, startY + drawH + dimDist + 50);

    // ××™×“×” ×× ×›×™×ª (×’×•×‘×”/×¢×•××§)
    const labelSide = (type === 'pergola') ? "×¢×•××§" : "";
    ctx.beginPath(); ctx.moveTo(startX + drawW + dimDist, startY); ctx.lineTo(startX + drawW + dimDist, startY + drawH); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(startX + drawW + dimDist - 15, startY); ctx.lineTo(startX + drawW + dimDist + 15, startY); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(startX + drawW + dimDist - 15, startY + drawH); ctx.lineTo(startX + drawW + dimDist + 15, startY + drawH); ctx.stroke();
    
    ctx.save(); ctx.translate(startX + drawW + dimDist + 50, startY + drawH/2); ctx.rotate(-Math.PI/2); ctx.textAlign = "center";
    ctx.fillText(`${dim2} ${labelSide}`, 0, 0); ctx.restore();

    // ×”×•×¨×“×”
    const link = document.createElement('a');
    link.download = `Sketch_${typeText}_${wVal}x${hVal}.png`;
    link.href = canvas.toDataURL();
    link.click();
}
</script>
</body>
</html>
