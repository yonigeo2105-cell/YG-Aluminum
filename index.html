<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•× - ××¢×¨×›×ª ×”×¦×¢×•×ª ××—×™×¨ PRO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        :root {
            --primary: #1e40af; /* ×›×—×•×œ ××œ×•××™× ×™×•× ×¢××•×§ */
            --secondary: #3b82f6;
            --accent: #f59e0b;
            --bg: #f3f4f6;
            --surface: #ffffff;
            --text: #111827;
            --border: #e5e7eb;
        }

        body {
            font-family: system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--surface);
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--primary);
            padding-bottom: 20px;
        }

        h1 { color: var(--primary); margin: 0; font-size: 2.5rem; }
        h2 { font-size: 1.2rem; color: #6b7280; font-weight: normal; }

        /* ×˜××‘×™× ×œ×‘×—×™×¨×ª ××•×¦×¨ */
        .tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
            justify-content: center;
        }

        .tab-btn {
            background: var(--surface);
            border: 1px solid var(--border);
            padding: 10px 20px;
            cursor: pointer;
            border-radius: 8px;
            font-weight: bold;
            transition: all 0.2s;
        }

        .tab-btn:hover { background: #eff6ff; }
        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* ××–×•×¨ ×¢×‘×•×“×” ×¨××©×™ */
        .workspace {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        @media (max-width: 768px) {
            .workspace { grid-template-columns: 1fr; }
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--border);
            border-radius: 6px;
            font-size: 1rem;
            box-sizing: border-box;
        }

        .row {
            display: flex;
            gap: 10px;
        }
        
        .checkbox-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }
        .checkbox-wrapper input { width: auto; }

        /* ×§× ×‘×¡ ×©×¨×˜×•×˜ */
        .canvas-container {
            background: white;
            border: 2px dashed var(--border);
            border-radius: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            position: relative;
            overflow: hidden;
        }

        canvas {
            max-width: 100%;
            max-height: 100%;
        }

        .price-section {
            background: #ecfdf5;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #10b981;
            margin-top: 20px;
        }

        .add-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
        }

        .add-btn:hover { background: #1e3a8a; }

        /* ×˜×‘×œ×ª ×”×¦×¢×ª ××—×™×¨ */
        .quote-list {
            margin-top: 40px;
            border-top: 2px solid var(--border);
            padding-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            text-align: right;
            padding: 12px;
            border-bottom: 1px solid var(--border);
        }

        th { background-color: #f9fafb; }
        
        .item-row img {
            max-width: 100px;
            max-height: 80px;
            border: 1px solid #ddd;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
            justify-content: flex-end;
        }

        .action-btn {
            padding: 12px 25px;
            border-radius: 8px;
            text-decoration: none;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            border: none;
        }

        .btn-whatsapp { background-color: #25D366; color: white; }
        .btn-pdf { background-color: #ef4444; color: white; }

        /* ×˜×§×¡×˜ ××©×¤×˜×™ */
        .legal-footer {
            margin-top: 50px;
            font-size: 0.8rem;
            color: #666;
            border-top: 1px solid #ccc;
            padding-top: 10px;
            text-align: center;
        }

        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container" id="quote-area">
    <header>
        <h1>×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•×</h1>
        <h2>××¢×¨×›×ª ×”×¦×¢×•×ª ××—×™×¨ ×•×©×¨×˜×•×˜ ××ª×§×“×</h2>
    </header>

    <div class="customer-details">
        <div class="row">
            <div class="form-group" style="flex:1">
                <label>×©× ×”×œ×§×•×—</label>
                <input type="text" id="custName" placeholder="×©× ××œ×">
            </div>
            <div class="form-group" style="flex:1">
                <label>×ª××¨×™×š</label>
                <input type="date" id="quoteDate">
            </div>
        </div>
    </div>

    <div class="tabs" id="productTabs">
        <button class="tab-btn active" onclick="setProduct('sliding')">×—×œ×•×Ÿ ×”×–×–×”</button>
        <button class="tab-btn" onclick="setProduct('pocket')">×—×œ×•×Ÿ ×›×™×¡</button>
        <button class="tab-btn" onclick="setProduct('hinge')">×—×œ×•×Ÿ ×¦×™×¨/×“×¨×™×™ ×§×™×¤</button>
        <button class="tab-btn" onclick="setProduct('fixed')">×§×‘×•×¢ / ×•×™×˜×¨×™× ×”</button>
        <button class="tab-btn" onclick="setProduct('door')">×“×œ×ª×•×ª ×›× ×™×¡×”/×œ×•×‘×™</button>
        <button class="tab-btn" onclick="setProduct('shutter')">×ª×¨×™×¡×™×</button>
        <button class="tab-btn" onclick="setProduct('screen_roll')">×¨×©×ª ×’×œ×™×œ×”</button>
        <button class="tab-btn" onclick="setProduct('shower')">××§×œ×—×•× ×™×</button>
        <button class="tab-btn" onclick="setProduct('pergola')">×¤×¨×’×•×œ×•×ª</button>
        <button class="tab-btn" onclick="setProduct('fence')">×’×“×¨×•×ª</button>
        <button class="tab-btn" onclick="setProduct('joker')">×¢×‘×•×“×•×ª ×›×œ×œ×™×•×ª</button>
    </div>

    <div class="workspace">
        <div class="controls" id="controlsPanel">
            </div>

        <div class="canvas-container">
            <canvas id="drawingCanvas" width="500" height="400"></canvas>
            <div id="imagePreview" style="display:none; width: 100%; height: 100%; object-fit: contain;"></div>
        </div>
    </div>

    <div class="price-section">
        <div class="row">
            <div class="form-group" style="flex:1">
                <label>×›××•×ª ×™×—×™×“×•×ª</label>
                <input type="number" id="quantity" value="1" min="1" onchange="updateTotal()">
            </div>
            <div class="form-group" style="flex:1">
                <label>××—×™×¨ ×œ×™×—×™×“×” (â‚ª)</label>
                <input type="number" id="manualPrice" placeholder="×”×–×Ÿ ××—×™×¨ ×¡×•×¤×™ ×œ××•×¦×¨" onchange="updateTotal()">
            </div>
        </div>
        <h3>×¡×”"×› ×œ×©×•×¨×” ×–×•: <span id="lineTotal">0</span> â‚ª</h3>
        <button class="add-btn" onclick="addItem()">×”×•×¡×£ ×œ×”×¦×¢×ª ×”××—×™×¨ â•</button>
    </div>

    <div class="quote-list">
        <h2>×¤×™×¨×•×˜ ×”×”×–×× ×”</h2>
        <table id="itemsTable">
            <thead>
                <tr>
                    <th>×ª××•× ×”/×©×¨×˜×•×˜</th>
                    <th>×ª×™××•×¨ ××•×¦×¨</th>
                    <th>××™×“×•×ª</th>
                    <th>×›××•×ª</th>
                    <th>××—×™×¨ ×™×—'</th>
                    <th>×¡×”"×›</th>
                    <th>××—×™×§×”</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <div style="text-align: left; margin-top: 20px; font-size: 1.5rem; font-weight: bold; color: var(--primary);">
            ×¡×”"×› ×œ×ª×©×œ×•×: <span id="grandTotal">0</span> â‚ª
        </div>

        <div class="legal-footer">
            <p>* ×”××—×™×¨ ×›×•×œ×œ ×”×•×‘×œ×”.</p>
            <p>* ×”×¦×¢×ª ××—×™×¨ ×–××ª ××©××©×ª ×›×—×•×–×”.</p>
            <p>* ×”×¡×—×•×¨×” ×‘×‘×¢×œ×•×ª ×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•× ×¢×“ ×”×ª×©×œ×•× ×”××œ×.</p>
            <p>* ×”×¦×¢×ª ×”××—×™×¨ ×ª×§×¤×” ×œ-5 ×™××™ ×¢×¡×§×™× ×•×™×ª×›× ×• ×©×™× ×•×™×™× ×§×œ×™× ×‘×™×•× ×—×ª×™××ª ×”×—×•×–×”.</p>
            <p style="font-weight: bold; margin-top: 10px;">×‘×›×‘×•×“ ×¨×‘, ×™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•×</p>
        </div>
    </div>
</div>

<div class="actions container" style="margin-top: 20px; background: transparent; box-shadow: none;">
    <button class="action-btn btn-pdf" onclick="generatePDF()">ğŸ“„ ×”×•×¨×“ ×”×¦×¢×ª ××—×™×¨ (PDF)</button>
    <button class="action-btn btn-whatsapp" onclick="sendWhatsapp()">ğŸ“± ×©×œ×— ×‘×•×•××˜×¡××¤</button>
</div>

<script>
    // --- ××©×ª× ×™× ×’×œ×•×‘×œ×™×™× ---
    let currentType = 'sliding';
    let cart = [];
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let uploadedImage = null;

    // --- ×ª××¨×™×š ×‘×¨×™×¨×ª ××—×“×œ ---
    document.getElementById('quoteDate').valueAsDate = new Date();

    // --- ×”×’×“×¨×•×ª ×¡×“×¨×•×ª ×•× ×ª×•× ×™× ---
    const profiles = {
        sliding: ['×§×œ×™×œ 7000 ×§×œ××¡×™', '×§×œ×™×œ 9000', '×§×œ×™×œ 9200 (××¤×•××¨)', '×§×œ×™×œ 1700 (×‘×œ×’×™)'],
        pocket: ['×›×™×¡ ×‘×•×“×“ - ××¡×™×œ×” 2 × ×ª×™×‘×™×', '×›×™×¡ ×‘×•×“×“ - ××¡×™×œ×” 3 × ×ª×™×‘×™×', '×›×™×¡ ×›×¤×•×œ - ××¡×™×œ×” 2 × ×ª×™×‘×™×', '×›×™×¡ ×›×¤×•×œ - ××¡×™×œ×” 3 × ×ª×™×‘×™×'],
        hinge: ['×§×œ×™×œ 4500 (×§×œ××¡×™)', '×§×œ×™×œ 4300 (×‘×œ×’×™)', '×§×œ×™×œ 5500 (××©×¨×“×™)'],
        fixed: ['×§×œ×™×œ 4300 ×‘×œ×’×™ FIX', '×§×œ×™×œ 4500 ×§×œ××¡×™ FIX', '×§×œ×™×œ 2000 ×‘×™×™×¡×™×§ FIX', '×§×œ×™×œ 5500 ××•×¤×™×¡ FIX', '××ª×× 7000/9000'],
        door: ['×“×œ×ª 2000 ×¤× ×œ', '×“×œ×ª ×œ×•×‘×™ ×–×›×•×›×™×ª', '×“×œ×ª ×¦×™×¨ ×‘×œ×’×™ 4300'],
        shutter: ['×©×œ×‘ 8 (×¨×’×™×œ)', '×©×œ×‘ ××•×¨ (××™× ×™)', '×©×œ×‘ ××•×§×¦×£'],
        pergola: ['×¤×¨×•×¤×™×œ 15/5', '×¤×¨×•×¤×™×œ ×”×™×™×˜×§ 20/4'],
        fence: ['×”×™×™×˜×§ ××¤×¡', '×”×™×™×˜×§ 10', '×¨×¤×¤×”']
    };

    // --- ××ª×—×•×œ ×¨××©×•× ×™ ---
    setProduct('sliding');

    // --- ×¤×•× ×§×¦×™×™×ª ×”×—×œ×¤×ª ××•×¦×¨ ---
    function setProduct(type) {
        currentType = type;
        
        // ×¢×“×›×•×Ÿ ×˜××‘×™×
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active'); // ×©×™××•×© ×‘-event ×”× ×•×›×—×™
        
        // × ×™×§×•×™ ×ª××•× ×”
        uploadedImage = null;
        document.getElementById('imagePreview').style.display = 'none';
        canvas.style.display = 'block';

        renderControls();
        draw();
    }

    // --- ×‘× ×™×™×ª ×”×˜×•×¤×¡ ×“×™× ××™×ª ---
    function renderControls() {
        const panel = document.getElementById('controlsPanel');
        let html = '';

        // ×©×“×•×ª ××©×•×ª×¤×™× (×¨×•×—×‘/×’×•×‘×”) - ×œ×›×•×œ× ×—×•×¥ ×"×’'×•×§×¨"
        if (currentType !== 'joker') {
            html += `
            <div class="row">
                <div class="form-group" style="flex:1"><label>×¨×•×—×‘ (×¡"×)</label><input type="number" id="width" value="100" oninput="draw()"></div>
                <div class="form-group" style="flex:1"><label>×’×•×‘×” (×¡"×)</label><input type="number" id="height" value="100" oninput="draw()"></div>
            </div>`;
        }

        // ×œ×•×’×™×§×” ×™×™×—×•×“×™×ª ×œ×›×œ ××•×¦×¨
        switch (currentType) {
            case 'sliding':
                html += `
                    <div class="form-group"><label>×“×’× ×¤×¨×•×¤×™×œ</label><select id="profile" onchange="draw()">${getOptions(profiles.sliding)}</select></div>
                    <div class="form-group"><label>××¡×¤×¨ ×›× ×¤×™×™× (×”×§×œ×“ ××¡×¤×¨)</label><input type="number" id="sashCount" value="2" min="1" oninput="draw()"></div>
                    <div class="form-group"><label>×–×™×’×•×’</label><select id="glass"><option>×©×§×•×£ 4 ×"×</option><option>×˜×¨×™×¤×œ×§×¡ 3+3</option><option>×‘×™×“×•×“×™×ª 4-6-4</option><option>×—×œ×‘×™</option></select></div>
                    <div class="form-group"><label>×—×œ×•×§×” ("×‘×œ×’×™")</label><select id="division" onchange="draw()"><option value="none">×œ×œ×</option><option value="horizontal">×¤×¡×™× ×œ×¨×•×—×‘</option><option value="grid">×§×•×‘×™×•×ª</option></select></div>
                `;
                break;
            
            case 'pocket':
                html += `
                    <div class="form-group"><label>×¡×•×’ ×›×™×¡ ×•××¡×™×œ×”</label><select id="pocketType" onchange="draw()">${getOptions(profiles.pocket)}</select></div>
                    <div class="checkbox-wrapper"><input type="checkbox" id="brushTrim" checked> <label>×›×•×œ×œ ×”×œ×‘×©×•×ª ××‘×¨×©×ª</label></div>
                    <div class="form-group"><label>×”×¨×›×‘ ×›× ×£</label><select id="pocketSash"><option>×–×›×•×›×™×ª ×‘×œ×‘×“</option><option>×–×›×•×›×™×ª + ×ª×¨×™×¡</option><option>×–×›×•×›×™×ª + ×¨×©×ª + ×ª×¨×™×¡</option></select></div>
                `;
                break;

            case 'fixed':
                html += `
                    <div class="form-group"><label>×“×’× ×¤×¨×•×¤×™×œ</label><select id="profile" onchange="draw()">${getOptions(profiles.fixed)}</select></div>
                    <div class="checkbox-wrapper"><input type="checkbox" id="isNotch" onchange="toggleNotch(this.checked)"> <label>×™×© ××’×¨×¢×ª/×—×™×ª×•×š?</label></div>
                    <div id="notchControls" class="hidden" style="background:#eee; padding:10px; border-radius:5px;">
                        <label>××™×“×•×ª ×—×™×ª×•×š (×¡"×)</label>
                        <div class="row">
                            <input type="number" id="cutW" placeholder="×¨×•×—×‘ ×—×™×ª×•×š" oninput="draw()">
                            <input type="number" id="cutH" placeholder="×’×•×‘×” ×—×™×ª×•×š" oninput="draw()">
                        </div>
                    </div>
                `;
                break;

            case 'door':
                html += `
                    <div class="form-group"><label>×¡×•×’ ×“×œ×ª</label><select id="profile" onchange="draw()">${getOptions(profiles.door)}</select></div>
                    <div class="form-group"><label>××—×–×™×¨ ×©××Ÿ</label><select id="closer" onchange="draw()"><option value="none">×œ×œ×</option><option value="top">×—×™×¦×•× ×™ ×¢×œ×™×•×Ÿ</option><option value="floor">×¨×¦×¤×ª×™</option><option value="hidden">×¡××•×™</option></select></div>
                    <div class="checkbox-wrapper"><input type="checkbox" id="hasTopFixed" onchange="renderControls(); draw()"> <label>×§×‘×•×¢ ×¢×œ×™×•×Ÿ</label></div>
                    ${document.getElementById('hasTopFixed')?.checked ? '<input type="number" id="topFixedHeight" placeholder="×’×•×‘×” ×§×‘×•×¢ ×¢×œ×™×•×Ÿ" oninput="draw()">' : ''}
                    <div class="checkbox-wrapper"><input type="checkbox" id="hasSideFixed" onchange="renderControls(); draw()"> <label>×§×‘×•×¢ ×¦×“</label></div>
                    ${document.getElementById('hasSideFixed')?.checked ? '<input type="number" id="sideFixedWidth" placeholder="×¨×•×—×‘ ×§×‘×•×¢ ×¦×“" oninput="draw()">' : ''}
                `;
                break;

            case 'shutter':
                html += `
                    <div class="form-group"><label>×¡×•×’ ×©×œ×‘</label><select id="slatType" onchange="draw()"><option value="foam">××•×§×¦×£ (×¨×’×™×œ)</option><option value="light">×©×œ×‘ ××•×¨ (××™× ×™)</option></select></div>
                    <div class="form-group"><label>××¨×’×– ×ª×¨×™×¡</label><select id="boxType" onchange="draw()"><option value="hidden">××¨×’×– ×¡××•×™/×¤× ×™××™</option><option value="external">××¨×’×– ×—×™×¦×•× ×™ (××•× ×•×‘×œ×•×§)</option></select></div>
                    <div class="row">
                        <div class="form-group"><label>×¡×•×’ ×× ×•×¢</label><select id="motorType"><option>×™×“× ×™ (×¨×¦×•×¢×”)</option><option>×—×©××œ×™ ×¨×’×™×œ</option><option>×¡×•××¤×™ (Somfy)</option><option>×¡×•××¤×™ ×¨×“×™×•</option></select></div>
                        <div class="form-group"><label>×›×•×— (Nm)</label><input type="number" id="motorNm" placeholder="20"></div>
                    </div>
                `;
                break;

            case 'screen_roll':
                html += `
                    <div class="form-group"><label>×¡×•×’ ×¨×©×ª</label><input type="text" value="×¨×©×ª ×’×œ×™×œ×” (×× ×›×™×ª)" disabled></div>
                    <p style="font-size:0.8rem; color:gray;">* ××™×“×•×ª ×©××•×–× ×•×ª ×”×Ÿ ××™×“×•×ª ×¤×ª×— × ×˜×•. ×”×§×¡×˜×” ×ª×—×•×©×‘ ×¤× ×™××”.</p>
                `;
                break;

            case 'pergola':
                html += `
                    <div class="form-group"><label>×¡×•×’ ×¤×¨×•×¤×™×œ</label><select id="profile">${getOptions(profiles.pergola)}</select></div>
                    <div class="form-group"><label>×§×™×¨×•×™ (×¡× ×˜×£)</label><select id="roofType" onchange="draw()"><option value="none">×œ×œ× ×§×™×¨×•×™</option><option value="bh">×¡× ×˜×£ BH (×›×•×•×¨×ª)</option><option value="greca">×¡× ×˜×£ ×’×œ×™ ×¨×’×™×œ</option></select></div>
                    <div class="checkbox-wrapper"><input type="checkbox" id="hasGutter" onchange="draw()"> <label>×›×•×œ×œ ××¨×–×‘ + ×™×¨×™×“×”</label></div>
                `;
                break;

            case 'fence':
                html += `
                    <div class="form-group"><label>×“×’×</label><select id="profile" onchange="draw()">${getOptions(profiles.fence)}</select></div>
                    <div class="form-group"><label>××¨×•×•×— ×‘×™×Ÿ ×©×œ×‘×™× (×"×)</label><select id="spacing" onchange="draw()"><option value="0">0 (××˜×•×)</option><option value="10">10 ×"×</option><option value="20">20 ×"×</option></select></div>
                    <div class="checkbox-wrapper"><input type="checkbox" id="hasGate" onchange="draw()"> <label>×©×¢×¨ ××©×•×œ×‘ ×‘×’×“×¨</label></div>
                `;
                break;
            
            case 'shower':
                html += `
                    <div class="form-group"><label>×¡×•×’ ××§×œ×—×•×Ÿ</label><select id="showerType" onchange="draw()"><option value="front">×—×–×™×ª (×“×œ×ª ××—×ª)</option><option value="corner">×¤×™× ×ª×™ (2 ×–×›×•×›×™×•×ª)</option></select></div>
                    <div class="form-group"><label>×¡×•×’ ×–×›×•×›×™×ª</label><select><option>×©×§×•×¤×” 8 ×"×</option><option>×’×¨× ×™×˜/×¤×¡×™×</option><option>××§×¡×˜×¨× ×§×œ×™×¨</option></select></div>
                `;
                break;

            case 'joker':
                html += `
                    <div class="form-group"><label>×©× ×”×¢×‘×•×“×”</label><input type="text" id="jokerTitle" placeholder="×œ×“×•×’××”: ×”×’×‘×”×ª ××¢×§×”"></div>
                    <div class="form-group"><label>×ª×™××•×¨ ××¤×•×¨×˜</label><textarea id="jokerDesc" rows="4" placeholder="×¤×¨×˜ ×›××Ÿ ××ª ××”×•×ª ×”×¢×‘×•×“×”..."></textarea></div>
                    <div class="form-group"><label>×”×¢×œ××ª ×ª××•× ×”/×¡×§×™×¦×”</label><input type="file" id="jokerImg" accept="image/*" onchange="handleImageUpload(this)"></div>
                `;
                break;
        }

        // ×¦×‘×¢ ×¤×¨×•×¤×™×œ (×œ×›×•×œ× ×—×•×¥ ××’'×•×§×¨)
        if (currentType !== 'joker') {
            html += `<div class="form-group"><label>×¦×‘×¢ ×¤×¨×•×¤×™×œ</label><input type="text" id="color" placeholder="×œ×“×•×’××”: ×œ×‘×Ÿ, 9005, 7016"></div>`;
        }
        
        // ×”×¢×¨×•×ª
        html += `<div class="form-group"><label>×”×¢×¨×•×ª</label><input type="text" id="notes" placeholder="×”×¢×¨×•×ª ×œ×”×“×¤×¡×”"></div>`;

        panel.innerHTML = html;
        
        // ×× ×”×—×œ×¤× ×• ××•×¦×¨, × ×¦×™×™×¨ ×©×•×‘ ×›×“×™ ×œ××¤×¡
        if (currentType !== 'joker') draw();
    }

    function getOptions(arr) {
        return arr.map(item => `<option value="${item}">${item}</option>`).join('');
    }

    function toggleNotch(isChecked) {
        document.getElementById('notchControls').classList.toggle('hidden', !isChecked);
        draw();
    }

    // --- ×˜×™×¤×•×œ ×‘×”×¢×œ××ª ×ª××•× ×” ---
    function handleImageUpload(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedImage = e.target.result;
                document.getElementById('drawingCanvas').style.display = 'none';
                const imgDiv = document.getElementById('imagePreview');
                imgDiv.style.display = 'block';
                imgDiv.innerHTML = `<img src="${uploadedImage}" style="max-width:100%; max-height:100%;" />`;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

    // --- ×× ×•×¢ ×”×©×¨×˜×•×˜ (The Drawing Engine) ---
    function draw() {
        // × ×™×§×•×™ ×§× ×‘×¡
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        if (currentType === 'joker') return; // ×‘×’'×•×§×¨ ××™×Ÿ ×©×¨×˜×•×˜ ××•×˜×•××˜×™

        const wInput = document.getElementById('width').value || 100;
        const hInput = document.getElementById('height').value || 100;

        // ×”×’×“×¨×ª ×§× ×” ××™×“×” (Scale)
        const padding = 50;
        const scaleX = (canvas.width - padding * 2) / wInput;
        const scaleY = (canvas.height - padding * 2) / hInput;
        const scale = Math.min(scaleX, scaleY);
        
        const drawW = wInput * scale;
        const drawH = hInput * scale;
        const startX = (canvas.width - drawW) / 2;
        const startY = (canvas.height - drawH) / 2;

        ctx.strokeStyle = '#333';
        ctx.lineWidth = 2;
        ctx.fillStyle = '#eef2ff'; // ×¦×‘×¢ ×–×›×•×›×™×ª ×‘×¨×™×¨×ª ××—×“×œ

        // ×œ×•×’×™×§×” ×œ×¤×™ ×¡×•×’
        if (currentType === 'sliding') {
            const sashes = document.getElementById('sashCount').value;
            const division = document.getElementById('division').value;
            
            // ××¡×’×¨×ª ×¨××©×™×ª
            ctx.strokeRect(startX, startY, drawW, drawH);
            
            // ×—×œ×•×§×” ×œ×›× ×¤×™×™×
            const sashW = drawW / sashes;
            for (let i = 0; i < sashes; i++) {
                // ××¡×’×¨×ª ×›× ×£
                ctx.strokeRect(startX + (i * sashW) + 5, startY + 5, sashW - 10, drawH - 10);
                
                // ×™×“×™×ª (×××¦×¢ ×’×•×‘×”, ×‘×¦×“)
                ctx.fillStyle = '#000';
                ctx.fillRect(startX + (i * sashW) + 10, startY + drawH/2 - 10, 4, 20); 
                ctx.fillStyle = '#eef2ff';

                // ×—×œ×•×§×•×ª ×‘×œ×’×™×•×ª
                if (division === 'horizontal') {
                    ctx.beginPath();
                    ctx.moveTo(startX + (i * sashW) + 5, startY + drawH/3);
                    ctx.lineTo(startX + (i * sashW) + sashW - 5, startY + drawH/3);
                    ctx.moveTo(startX + (i * sashW) + 5, startY + (drawH/3)*2);
                    ctx.lineTo(startX + (i * sashW) + sashW - 5, startY + (drawH/3)*2);
                    ctx.stroke();
                } else if (division === 'grid') {
                     // ×§×•×•×™× ××•×¤×§×™×™×
                    ctx.beginPath();
                    ctx.moveTo(startX + (i * sashW) + 5, startY + drawH/2);
                    ctx.lineTo(startX + (i * sashW) + sashW - 5, startY + drawH/2);
                    // ×§×• ×× ×›×™
                    ctx.moveTo(startX + (i * sashW) + sashW/2, startY + 5);
                    ctx.lineTo(startX + (i * sashW) + sashW/2, startY + drawH - 10);
                    ctx.stroke();
                }
            }
            // ×—×¥ ×›×™×•×•×Ÿ
            drawArrow(startX + 20, startY + drawH/2, startX + drawW - 20, startY + drawH/2);
        }

        else if (currentType === 'pocket') {
            const pocketType = document.getElementById('pocketType').value;
            const isDouble = pocketType.includes('×›×¤×•×œ');
            const tracks = pocketType.includes('3') ? 3 : 2;
            
            // ×©×¨×˜×•×˜ ×§×™×¨ (××§×•×•×§×•)
            ctx.setLineDash([5, 5]);
            ctx.strokeStyle = '#999';
            
            if (!isDouble) {
                // ×§×™×¨ ×›×™×¡ ××™××™×Ÿ
                ctx.strokeRect(startX + drawW, startY, drawW * 0.8, drawH);
                ctx.strokeRect(startX + drawW, startY, drawW * 0.8, drawH);
            }
            ctx.setLineDash([]);
            ctx.strokeStyle = '#333';

            // ××¡×’×¨×ª ×¤×ª×—
            ctx.strokeRect(startX, startY, drawW, drawH);
            
            // ××¡×™×œ×•×ª ×‘×¨×¦×¤×” (2 ××• 3)
            for(let i=1; i<=tracks; i++) {
                ctx.beginPath();
                ctx.moveTo(startX, startY + drawH - (i*5));
                // ×”××¡×™×œ×” ×××©×™×›×” ×œ×ª×•×š ×”×›×™×¡
                const endTrack = isDouble ? startX + drawW + 20 : startX + drawW * 1.8;
                ctx.lineTo(endTrack, startY + drawH - (i*5));
                ctx.strokeStyle = '#666';
                ctx.stroke();
            }

            // ×›× ×£ × ×›× ×¡×ª
            ctx.fillStyle = 'rgba(200, 230, 255, 0.5)';
            ctx.fillRect(startX + drawW/2, startY + 5, drawW/2, drawH - 10);
            ctx.strokeRect(startX + drawW/2, startY + 5, drawW/2, drawH - 10);
            
            // ×—×¥ ×œ×ª×•×š ×”×›×™×¡
            drawArrow(startX + drawW/2, startY + drawH/2, startX + drawW + 30, startY + drawH/2);
        }

        else if (currentType === 'fixed') {
             // ×‘×“×™×§×ª ××’×¨×¢×ª
             const isNotch = document.getElementById('isNotch')?.checked;
             
             ctx.beginPath();
             if (isNotch) {
                 const cutW = (document.getElementById('cutW').value || 0) * scale;
                 const cutH = (document.getElementById('cutH').value || 0) * scale;
                 // ×©×¨×˜×•×˜ ××œ×‘×Ÿ ×¢× ×—×™×ª×•×š ×‘×¤×™× ×” ×™×× ×™×ª ×¢×œ×™×•× ×”
                 ctx.moveTo(startX, startY);
                 ctx.lineTo(startX + drawW - cutW, startY); // ×¢×œ×™×•×Ÿ ×¢×“ ×”×—×™×ª×•×š
                 ctx.lineTo(startX + drawW - cutW, startY + cutH); // ×™×•×¨×“ ×œ××˜×”
                 ctx.lineTo(startX + drawW, startY + cutH); // ×™××™× ×”
                 ctx.lineTo(startX + drawW, startY + drawH); // ×™×•×¨×“ ×¢×“ ×”×¡×•×£
                 ctx.lineTo(startX, startY + drawH); // ×©×××œ×”
                 ctx.closePath();
                 
                 // ×˜×§×¡×˜ ××™×“×•×ª ×”×—×™×ª×•×š
                 ctx.fillStyle = 'red';
                 ctx.fillText(`×—×™×ª×•×š: ${document.getElementById('cutW').value}/${document.getElementById('cutH').value}`, startX + drawW - cutW - 10, startY + cutH + 15);
             } else {
                 ctx.rect(startX, startY, drawW, drawH);
             }
             ctx.stroke();
             // ×§×•×•×™ ×”×¦×œ×œ×” ×œ×–×›×•×›×™×ª
             ctx.beginPath();
             ctx.moveTo(startX + 10, startY + drawH - 10);
             ctx.lineTo(startX + drawW - 10, startY + 10);
             ctx.strokeStyle = '#ddd';
             ctx.stroke();
        }

        else if (currentType === 'shutter') {
            const slatType = document.getElementById('slatType').value;
            const boxType = document.getElementById('boxType').value;
            
            let boxH = 30 * scale; // ×’×•×‘×” ××¨×’×–
            
            // ×©×¨×˜×•×˜ ×”××¨×’×–
            if (boxType === 'external') {
                ctx.fillStyle = '#ddd';
                ctx.fillRect(startX - 10, startY - boxH, drawW + 20, boxH);
                ctx.strokeRect(startX - 10, startY - boxH, drawW + 20, boxH);
                ctx.fillStyle = '#000';
                ctx.fillText('××¨×’×– ×—×™×¦×•× ×™', startX + drawW/2 - 30, startY - boxH/2);
            } else {
                ctx.setLineDash([5, 5]); // ××¨×’×– × ×¡×ª×¨
                ctx.strokeRect(startX, startY - boxH, drawW, boxH);
                ctx.setLineDash([]);
                ctx.fillText('××¨×’×– × ×¡×ª×¨', startX + drawW/2 - 30, startY - boxH/2);
            }

            // ××¡×™×œ×•×ª
            ctx.strokeRect(startX, startY, drawW, drawH); // ××¡×’×¨×ª
            
            // ×©×œ×‘×™×
            const slatH = (slatType === 'light') ? 15 : 10;
            const gap = (slatType === 'light') ? 4 : 0;
            
            for (let y = startY; y < startY + drawH; y += (slatH + gap)) {
                ctx.strokeRect(startX + 5, y, drawW - 10, slatH);
            }
        }
        
        else if (currentType === 'pergola') {
            // ×¢××•×“×™×
            ctx.fillRect(startX + 10, startY + 20, 10, drawH - 20); // ×¢××•×“ ×©×××œ
            ctx.fillRect(startX + drawW - 20, startY + 20, 10, drawH - 20); // ×¢××•×“ ×™××™×Ÿ
            
            // ×§×•×¨×•×ª (×¤×¨×’×•×œ×” ×‘××‘×˜ ×¢×œ ××• ×—×ª×š) - × ×¦×™×™×¨ ×§×•×¨×•×ª ××•×¨×š
            const roofType = document.getElementById('roofType').value;
            
            for (let x = startX; x < startX + drawW; x += 30) {
                 ctx.strokeRect(x, startY + 20, 5, drawH - 20); // ×”×¦×œ×œ×”
            }
            
            // ××¡×’×¨×ª ×¢×œ×™×•× ×”
            ctx.strokeRect(startX, startY, drawW, drawH);

            // ×§×™×¨×•×™ ×¡× ×˜×£
            if (roofType !== 'none') {
                ctx.beginPath();
                ctx.strokeStyle = 'blue';
                // ×’×œ×™×
                for (let x = startX; x < startX + drawW; x+=10) {
                    ctx.lineTo(x, startY + (x%20===0 ? 0 : 5));
                }
                ctx.stroke();
                ctx.fillText(roofType === 'bh' ? '×¡× ×˜×£ BH ×›×•×•×¨×ª' : '×¡× ×˜×£ ×’×œ×™', startX + 10, startY - 10);
            }
            
            // ××¨×–×‘
            if (document.getElementById('hasGutter').checked) {
                ctx.fillStyle = '#555';
                ctx.fillRect(startX + drawW, startY, 15, drawH); // ××¨×–×‘ ×‘×¦×“
                ctx.beginPath();
                ctx.arc(startX + drawW + 7, startY + drawH, 10, 0, 2*Math.PI); // ×™×¦×™××”
                ctx.fill();
                ctx.fillText('××¨×–×‘', startX + drawW + 20, startY + 20);
            }
        }
        
        else if (currentType === 'screen_roll') {
            // ×§×¡×˜×” ×œ××¢×œ×”
            const boxH = 40; // ×§×‘×•×¢ ×‘×¤×™×§×¡×œ×™× ×œ×¦×™×•×¨
            ctx.fillStyle = '#ddd';
            ctx.fillRect(startX, startY, drawW, boxH);
            ctx.strokeRect(startX, startY, drawW, boxH);
            ctx.fillStyle = '#000';
            ctx.fillText('×§×¡×˜×” ×¢×œ×™×•× ×”', startX + drawW/2 - 30, startY + 25);
            
            // ××¡×™×œ×•×ª ×¦×“
            ctx.fillRect(startX, startY + boxH, 10, drawH - boxH);
            ctx.fillRect(startX + drawW - 10, startY + boxH, 10, drawH - boxH);
            
            // ×¨×©×ª
            ctx.globalAlpha = 0.2;
            ctx.fillStyle = 'gray';
            ctx.fillRect(startX + 10, startY + boxH, drawW - 20, drawH - boxH);
            ctx.globalAlpha = 1.0;
            
            ctx.strokeRect(startX, startY, drawW, drawH);
        }

        else if (currentType === 'door') {
            const hasTop = document.getElementById('hasTopFixed')?.checked;
            const hasSide = document.getElementById('hasSideFixed')?.checked;
            let topH = 0;
            let sideW = 0;

            if (hasTop) topH = (canvas.height * 0.2); // ×•×™×–×•××œ×™ ×‘×œ×‘×“
            if (hasSide) sideW = (canvas.width * 0.2);

            // ××¡×’×¨×ª ×¨××©×™×ª (×”×›×œ)
            const totalW = drawW; 
            const totalH = drawH;
            
            // ×©×¨×˜×•×˜ ×§×‘×•×¢ ×¢×œ×™×•×Ÿ
            if (hasTop) {
                ctx.strokeRect(startX, startY, totalW, topH);
                ctx.fillText('×§×‘×•×¢ ×¢×œ×™×•×Ÿ', startX + totalW/2 - 20, startY + topH/2);
            }
            
            // ×©×¨×˜×•×˜ ×§×‘×•×¢ ×¦×“
            if (hasSide) {
                ctx.strokeRect(startX, startY + topH, sideW, totalH - topH);
                ctx.fillText('×§×‘×•×¢ ×¦×“', startX + 5, startY + totalH/2);
            }
            
            // ×”×“×œ×ª ×¢×¦××”
            const doorX = startX + sideW;
            const doorY = startY + topH;
            const doorW = totalW - sideW;
            const doorH = totalH - topH;
            
            ctx.strokeRect(doorX, doorY, doorW, doorH);
            
            // ××©×•×œ×© ×¤×ª×™×—×”
            ctx.beginPath();
            ctx.moveTo(doorX, doorY);
            ctx.lineTo(doorX + doorW, doorY + doorH/2);
            ctx.lineTo(doorX, doorY + doorH);
            ctx.strokeStyle = '#aaa';
            ctx.stroke();

            // ××—×–×™×¨ ×©××Ÿ
            const closer = document.getElementById('closer').value;
            if (closer !== 'none') {
                ctx.fillStyle = 'black';
                // ××©×•×œ×© ×§×˜×Ÿ ×œ××¢×œ×”
                ctx.beginPath();
                ctx.moveTo(doorX + doorW - 10, doorY);
                ctx.lineTo(doorX + doorW - 40, doorY);
                ctx.lineTo(doorX + doorW - 10, doorY + 20);
                ctx.fill();
                ctx.fillText('××—×–×™×¨ ×©××Ÿ', doorX + doorW - 60, doorY - 5);
            }
        }

        else {
            // ×‘×¨×™×¨×ª ××—×“×œ ×œ×›×œ ×”×©××¨
            ctx.strokeRect(startX, startY, drawW, drawH);
            ctx.fillText(currentType, startX + drawW/2, startY + drawH/2);
        }

        // ×˜×§×¡×˜ ××™×“×•×ª ×¨××©×™×•×ª
        ctx.fillStyle = '#000';
        ctx.font = '14px Arial';
        ctx.textAlign = 'center';
        // ×¨×•×—×‘
        ctx.fillText(`${wInput}`, startX + drawW / 2, startY - 10);
        // ×’×•×‘×”
        ctx.textAlign = 'left';
        ctx.fillText(`${hInput}`, startX + drawW + 10, startY + drawH / 2);
    }

    function drawArrow(fromx, fromy, tox, toy) {
        var headlen = 10;
        var dx = tox - fromx;
        var dy = toy - fromy;
        var angle = Math.atan2(dy, dx);
        ctx.beginPath();
        ctx.moveTo(fromx, fromy);
        ctx.lineTo(tox, toy);
        ctx.lineTo(tox - headlen * Math.cos(angle - Math.PI / 6), toy - headlen * Math.sin(angle - Math.PI / 6));
        ctx.moveTo(tox, toy);
        ctx.lineTo(tox - headlen * Math.cos(angle + Math.PI / 6), toy - headlen * Math.sin(angle + Math.PI / 6));
        ctx.stroke();
    }

    // --- ×”×•×¡×¤×” ×œ×¡×œ ---
    function addItem() {
        const qty = parseInt(document.getElementById('quantity').value);
        const price = parseFloat(document.getElementById('manualPrice').value);
        
        if (!price || price <= 0) {
            alert('× × ×œ×”×–×™×Ÿ ××—×™×¨ ×œ××•×¦×¨');
            return;
        }

        let desc = '';
        let dims = '';
        let imgSrc = '';

        if (currentType === 'joker') {
            desc = `<b>${document.getElementById('jokerTitle').value}</b><br>${document.getElementById('jokerDesc').value}`;
            dims = '-';
            imgSrc = uploadedImage || ''; // ×©×™××•×© ×‘×ª××•× ×” ×©×”×•×¢×œ×ª×”
        } else {
            // ×‘× ×™×™×ª ×ª×™××•×¨ ××•×˜×•××˜×™
            const w = document.getElementById('width').value;
            const h = document.getElementById('height').value;
            dims = `${w} X ${h}`;
            
            const profile = document.getElementById('profile') ? document.getElementById('profile').value : '';
            const color = document.getElementById('color').value;
            desc = `<b>${translateType(currentType)}</b> - ${profile}`;
            if(color) desc += `<br>×¦×‘×¢: ${color}`;
            
            // ×ª×•×¡×¤×•×ª ×¡×¤×¦×™×¤×™×•×ª
            if(currentType === 'sliding') desc += `<br>×›× ×¤×™×™×: ${document.getElementById('sashCount').value}, ${document.getElementById('glass').value}`;
            if(currentType === 'shutter') {
                const motor = document.getElementById('motorType').value;
                desc += `<br>×©×œ×‘: ${document.getElementById('slatType').value}, ×× ×•×¢: ${motor}`;
                if(motor.includes('×¡×•××¤×™') || motor.includes('×—×©××œ×™')) {
                     desc += ` (${document.getElementById('motorNm').value}Nm)`;
                }
            }
            if(currentType === 'pergola') desc += `<br>×§×™×¨×•×™: ${document.getElementById('roofType').value}`;
            
            // ×œ×§×™×—×ª ×ª××•× ×” ××”×§× ×‘×¡
            imgSrc = canvas.toDataURL();
        }

        const item = {
            id: Date.now(),
            desc: desc,
            dims: dims,
            qty: qty,
            price: price,
            total: qty * price,
            image: imgSrc
        };

        cart.push(item);
        renderCart();
        
        // ××™×¤×•×¡ ×©×“×•×ª ××—×™×¨
        document.getElementById('manualPrice').value = '';
        document.getElementById('lineTotal').innerText = '0';
        if(currentType === 'joker') {
            document.getElementById('jokerTitle').value = '';
            document.getElementById('jokerDesc').value = '';
            document.getElementById('jokerImg').value = '';
            uploadedImage = null;
            document.getElementById('imagePreview').style.display = 'none';
        }
    }

    function renderCart() {
        const tbody = document.querySelector('#itemsTable tbody');
        tbody.innerHTML = '';
        let grandTotal = 0;

        cart.forEach((item, index) => {
            grandTotal += item.total;
            const tr = document.createElement('tr');
            tr.className = 'item-row';
            tr.innerHTML = `
                <td>${item.image ? `<img src="${item.image}">` : ''}</td>
                <td style="text-align:right;">${item.desc}</td>
                <td>${item.dims}</td>
                <td>${item.qty}</td>
                <td>â‚ª${item.price.toLocaleString()}</td>
                <td>â‚ª${item.total.toLocaleString()}</td>
                <td><button onclick="removeItem(${index})" style="background:red; color:white; border:none; border-radius:4px; cursor:pointer;">X</button></td>
            `;
            tbody.appendChild(tr);
        });

        document.getElementById('grandTotal').innerText = grandTotal.toLocaleString();
    }

    function removeItem(index) {
        cart.splice(index, 1);
        renderCart();
    }

    function updateTotal() {
        const q = document.getElementById('quantity').value;
        const p = document.getElementById('manualPrice').value;
        document.getElementById('lineTotal').innerText = (q * p).toLocaleString();
    }

    function translateType(type) {
        const types = {
            'sliding': '×—×œ×•×Ÿ ×”×–×–×”', 'pocket': '×—×œ×•×Ÿ ×›×™×¡', 'hinge': '×—×œ×•×Ÿ ×¦×™×¨', 
            'fixed': '×§×‘×•×¢', 'door': '×“×œ×ª ×›× ×™×¡×”', 'shutter': '×ª×¨×™×¡', 
            'screen_roll': '×¨×©×ª ×’×œ×™×œ×”', 'shower': '××§×œ×—×•×Ÿ', 'pergola': '×¤×¨×’×•×œ×”', 
            'fence': '×’×“×¨', 'joker': '×¢×‘×•×“×•×ª ×›×œ×œ×™×•×ª'
        };
        return types[type] || type;
    }

    // --- ×™×™×¦×•× ---
    function sendWhatsapp() {
        let text = `×©×œ×•× ${document.getElementById('custName').value || '×œ×§×•×—'},\n×”× ×” ×”×¦×¢×ª ××—×™×¨ ××™×”×•× ×ª×Ÿ ××œ×•××™× ×™×•×:\n`;
        cart.forEach(item => {
            // × ×™×§×•×™ ×ª×’×™×•×ª HTML ×œ×•×•××˜×¡××¤
            const cleanDesc = item.desc.replace(/<br>/g, ', ').replace(/<b>/g, '*').replace(/<\/b>/g, '*');
            text += `\nğŸ“¦ ${cleanDesc}\n××™×“×•×ª: ${item.dims}\n×›××•×ª: ${item.qty} | ××—×™×¨: â‚ª${item.price}\n`;
        });
        text += `\n×¡×”"×›: â‚ª${document.getElementById('grandTotal').innerText}`;
        
        window.open(`https://wa.me/?text=${encodeURIComponent(text)}`);
    }

    function generatePDF() {
        const element = document.getElementById('quote-area');
        const opt = {
            margin: 0.5,
            filename: `×”×¦×¢×ª_××—×™×¨_${document.getElementById('custName').value}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2 },
            jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
        };
        
        // ×”×¡×ª×¨×ª ××œ×× ×˜×™× ×œ× ×¨×¦×•×™×™× ×‘-PDF
        const controls = document.getElementById('productTabs');
        const panels = document.getElementById('controlsPanel');
        const canvasArea = document.querySelector('.canvas-container'); // ××¡×ª×™×¨×™× ××ª ××–×•×¨ ×”×¢×‘×•×“×”, ××©××™×¨×™× ×¨×§ ××ª ×”×˜×‘×œ×”
        const addBtn = document.querySelector('.price-section');
        
        controls.style.display = 'none';
        panels.style.display = 'none';
        canvasArea.style.display = 'none';
        addBtn.style.display = 'none';

        html2pdf().set(opt).from(element).save().then(() => {
            // ×”×—×–×¨×ª ×”×ª×¦×•×’×”
            controls.style.display = 'flex';
            panels.style.display = 'flex';
            canvasArea.style.display = 'flex';
            addBtn.style.display = 'block';
        });
    }

</script>

</body>
</html>
